---
// Enhanced WYSIWYG Editor Toolbar with advanced features
---

<!-- Link Modal -->
<div id="link-modal" class="editor-modal">
  <div class="modal-content compact">
    <div class="modal-header">
      <h3>Insert/Edit Link</h3>
      <button type="button" class="modal-close-btn">×</button>
    </div>
    <div class="modal-body">
      <div class="link-type-selector">
        <label class="radio-label">
          <input type="radio" name="link-type" value="external" checked />
          <span>External URL</span>
        </label>
        <label class="radio-label">
          <input type="radio" name="link-type" value="internal" />
          <span>Internal Page</span>
        </label>
      </div>
      
      <div id="external-link-fields" class="link-fields">
        <label>URL:</label>
        <input type="url" id="link-url" placeholder="https://example.com" class="form-input" />
      </div>
      
      <div id="internal-link-fields" class="link-fields" style="display: none;">
        <label>Select Page:</label>
        <select id="internal-page" class="form-input">
          <option value="/">Home</option>
          <option value="/team">Team</option>
          <option value="/tokenomics">Tokenomics</option>
          <option value="/blog">Blog</option>
          <option value="/smart-money">Smart Money</option>
        </select>
      </div>
      
      <label>Link Text:</label>
      <input type="text" id="link-text" placeholder="Click here" class="form-input" />
      
      <label class="checkbox-label">
        <input type="checkbox" id="link-new-tab" />
        <span>Open in new tab</span>
      </label>
      
      <div class="modal-actions">
        <button type="button" id="insert-link-btn" class="btn btn-primary">Insert Link</button>
        <button type="button" id="cancel-link-btn" class="btn btn-secondary">Cancel</button>
      </div>
    </div>
  </div>
</div>

<!-- Image Overlay Modal -->
<div id="overlay-modal" class="editor-modal">
  <div class="modal-content compact">
    <div class="modal-header">
      <h3>Image Text Overlay</h3>
      <button type="button" class="modal-close-btn">×</button>
    </div>
    <div class="modal-body">
      <label>Overlay Text:</label>
      <textarea id="overlay-text" class="form-input" rows="3" placeholder="Enter overlay text..."></textarea>
      
      <label>Position:</label>
      <div class="position-grid">
        <button type="button" class="position-btn" data-position="top-left">↖</button>
        <button type="button" class="position-btn" data-position="top-center">↑</button>
        <button type="button" class="position-btn" data-position="top-right">↗</button>
        <button type="button" class="position-btn" data-position="center-left">←</button>
        <button type="button" class="position-btn active" data-position="center">●</button>
        <button type="button" class="position-btn" data-position="center-right">→</button>
        <button type="button" class="position-btn" data-position="bottom-left">↙</button>
        <button type="button" class="position-btn" data-position="bottom-center">↓</button>
        <button type="button" class="position-btn" data-position="bottom-right">↘</button>
      </div>
      
      <label>Text Style:</label>
      <select id="overlay-style" class="form-input">
        <option value="light">Light text on dark overlay</option>
        <option value="dark">Dark text on light overlay</option>
        <option value="bold">Bold white with shadow</option>
      </select>
      
      <div class="modal-actions">
        <button type="button" id="apply-overlay-btn" class="btn btn-primary">Apply Overlay</button>
        <button type="button" id="cancel-overlay-btn" class="btn btn-secondary">Cancel</button>
      </div>
    </div>
  </div>
</div>

<!-- Cleanup Tools Panel -->
<div id="cleanup-panel" class="cleanup-panel">
  <div class="panel-header">
    <h3>Cleanup Tools</h3>
    <button type="button" class="panel-close">×</button>
  </div>
  <div class="panel-body">
    <button type="button" class="cleanup-btn" data-action="remove-empty">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M3 6h18M8 6V4a2 2 0 012-2h4a2 2 0 012 2v2m3 0v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6h14zM10 11v6M14 11v6"/>
      </svg>
      Remove Empty Elements
    </button>
    
    <button type="button" class="cleanup-btn" data-action="fix-images">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
        <circle cx="8.5" cy="8.5" r="1.5"/>
        <polyline points="21 15 16 10 5 21"/>
      </svg>
      Fix Broken Images
    </button>
    
    <button type="button" class="cleanup-btn" data-action="normalize-spacing">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="3" y1="6" x2="21" y2="6"/>
        <line x1="3" y1="12" x2="21" y2="12"/>
        <line x1="3" y1="18" x2="21" y2="18"/>
      </svg>
      Normalize Spacing
    </button>
    
    <button type="button" class="cleanup-btn" data-action="unwrap-elements">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M2 12h20M12 2v20"/>
      </svg>
      Unwrap Stuck Content
    </button>
    
    <button type="button" class="cleanup-btn" data-action="clear-formatting">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M4 7V4h16v3M9 20h6M12 4v16"/>
      </svg>
      Clear All Formatting
    </button>
    
    <button type="button" class="cleanup-btn danger" data-action="reset-content">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M3 12a9 9 0 019-9 9 9 0 110 18 9 9 0 01-9-9z"/>
        <path d="M9 9l6 6M15 9l-6 6"/>
      </svg>
      Reset Selected Content
    </button>
  </div>
</div>

<style>
  /* Editor Modals */
  .editor-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    z-index: 2000;
    padding: 2rem;
  }

  .editor-modal.active {
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .modal-content.compact {
    background: var(--color-surface);
    border-radius: var(--radius-lg);
    max-width: 500px;
    width: 100%;
    box-shadow: var(--shadow-xl);
  }

  .modal-header {
    padding: 1.25rem 1.5rem;
    border-bottom: 1px solid var(--color-border);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .modal-header h3 {
    margin: 0;
    font-size: 1.125rem;
    font-weight: 600;
  }

  .modal-close-btn {
    width: 28px;
    height: 28px;
    border: none;
    background: transparent;
    font-size: 1.5rem;
    color: var(--color-text-muted);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: var(--radius-sm);
    transition: all var(--transition-base);
  }

  .modal-close-btn:hover {
    background: var(--color-background);
    color: var(--color-text);
  }

  .modal-body {
    padding: 1.5rem;
  }

  .modal-body label {
    display: block;
    font-size: 0.875rem;
    font-weight: 500;
    margin-bottom: 0.5rem;
    color: var(--color-text);
  }

  .modal-body .form-input {
    width: 100%;
    padding: 0.625rem 0.875rem;
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    background: var(--color-background);
    color: var(--color-text);
    font-size: 0.875rem;
    margin-bottom: 1rem;
    transition: all var(--transition-base);
  }

  .modal-body .form-input:focus {
    outline: none;
    border-color: var(--color-primary);
    box-shadow: 0 0 0 3px var(--color-primary-alpha-20);
  }

  /* Link Type Selector */
  .link-type-selector {
    display: flex;
    gap: 1rem;
    margin-bottom: 1rem;
  }

  .radio-label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
    font-size: 0.875rem;
  }

  .checkbox-label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
    font-size: 0.875rem;
    margin-bottom: 1rem;
  }

  /* Position Grid */
  .position-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
    margin-bottom: 1rem;
  }

  .position-btn {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    background: var(--color-background);
    color: var(--color-text);
    cursor: pointer;
    transition: all var(--transition-base);
    font-size: 1.25rem;
  }

  .position-btn:hover {
    background: var(--color-primary-alpha-10);
    border-color: var(--color-primary);
  }

  .position-btn.active {
    background: var(--color-primary);
    color: white;
    border-color: var(--color-primary);
  }

  /* Modal Actions */
  .modal-actions {
    display: flex;
    gap: 0.75rem;
    margin-top: 1.5rem;
  }

  .modal-actions .btn {
    flex: 1;
  }

  /* Cleanup Panel */
  .cleanup-panel {
    position: fixed;
    right: -320px;
    top: 50%;
    transform: translateY(-50%);
    width: 300px;
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-xl);
    z-index: 1500;
    transition: right 0.3s ease;
  }

  .cleanup-panel.active {
    right: 20px;
  }

  .panel-header {
    padding: 1rem 1.25rem;
    border-bottom: 1px solid var(--color-border);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .panel-header h3 {
    margin: 0;
    font-size: 1rem;
    font-weight: 600;
  }

  .panel-close {
    width: 24px;
    height: 24px;
    border: none;
    background: transparent;
    font-size: 1.25rem;
    color: var(--color-text-muted);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .panel-body {
    padding: 1rem;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .cleanup-btn {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem 1rem;
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    background: var(--color-background);
    color: var(--color-text);
    font-size: 0.875rem;
    font-weight: 500;
    cursor: pointer;
    transition: all var(--transition-base);
    text-align: left;
  }

  .cleanup-btn:hover {
    background: var(--color-primary-alpha-10);
    border-color: var(--color-primary);
    color: var(--color-primary);
  }

  .cleanup-btn.danger {
    border-color: #ef4444;
    color: #ef4444;
  }

  .cleanup-btn.danger:hover {
    background: rgba(239, 68, 68, 0.1);
  }

  .btn {
    padding: 0.625rem 1.25rem;
    border-radius: var(--radius-md);
    font-size: 0.875rem;
    font-weight: 600;
    border: none;
    cursor: pointer;
    transition: all var(--transition-base);
  }

  .btn-primary {
    background: var(--color-primary);
    color: white;
  }

  .btn-secondary {
    background: var(--color-surface);
    color: var(--color-text);
    border: 1px solid var(--color-border);
  }

  .btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }
</style>

<script>
  // Editor instance reference
  let currentEditor = null;
  let selectedRange = null;

  // Initialize cleanup panel
  function initCleanupPanel() {
    const panel = document.getElementById('cleanup-panel');
    const closeBtn = panel?.querySelector('.panel-close');
    
    closeBtn?.addEventListener('click', () => {
      panel.classList.remove('active');
    });

    // Cleanup button handlers
    document.querySelectorAll('.cleanup-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const action = btn.dataset.action;
        if (currentEditor) {
          performCleanup(action);
        }
      });
    });
  }

  // Perform cleanup actions
  function performCleanup(action) {
    if (!currentEditor) return;

    switch (action) {
      case 'remove-empty':
        removeEmptyElements();
        break;
      case 'fix-images':
        fixBrokenImages();
        break;
      case 'normalize-spacing':
        normalizeSpacing();
        break;
      case 'unwrap-elements':
        unwrapStuckContent();
        break;
      case 'clear-formatting':
        clearFormatting();
        break;
      case 'reset-content':
        resetSelectedContent();
        break;
    }

    // Update content
    updateEditorContent();
  }

  // Remove empty elements
  function removeEmptyElements() {
    const emptyElements = currentEditor.querySelectorAll('p:empty, div:empty, span:empty');
    emptyElements.forEach(el => {
      if (!el.querySelector('img') && !el.querySelector('br')) {
        el.remove();
      }
    });

    // Remove multiple consecutive br tags
    const brs = currentEditor.querySelectorAll('br + br + br');
    brs.forEach(br => br.remove());
  }

  // Fix broken images
  function fixBrokenImages() {
    const images = currentEditor.querySelectorAll('img');
    const imagesToRemove = [];
    
    images.forEach(img => {
      let shouldRemove = false;
      
      // Check for placeholder images
      if (img.src.includes('data:image/svg') && img.src.includes('Click')) {
        shouldRemove = true;
      }
      
      // Check for broken images (common patterns)
      if (!img.complete || img.naturalWidth === 0) {
        shouldRemove = true;
      }
      
      // Check for error state
      if (img.classList.contains('broken') || img.style.display === 'none') {
        shouldRemove = true;
      }
      
      if (shouldRemove) {
        imagesToRemove.push(img);
      }
      
      // Add error handler for future broken images
      img.onerror = function() {
        // Mark as broken
        this.classList.add('broken');
        
        // Create replacement text
        const altText = document.createElement('p');
        altText.textContent = `[Broken image: ${this.alt || 'No description'}]`;
        altText.style.color = '#ef4444';
        altText.style.fontStyle = 'italic';
        altText.className = 'broken-image-placeholder';
        
        // Replace the image
        if (this.parentNode) {
          this.parentNode.replaceChild(altText, this);
        }
      };
    });
    
    // Remove all broken images and their containers
    imagesToRemove.forEach(img => {
      // Check for parent containers that should be removed
      const parent = img.closest('.blog-layout, .blog-gallery, .blog-image-wrapper, figure, .image-with-overlay');
      if (parent) {
        // Check if parent has other content
        const hasOtherContent = Array.from(parent.children).some(child => 
          child !== img && child.textContent.trim() !== ''
        );
        
        if (!hasOtherContent) {
          parent.remove();
        } else {
          img.remove();
        }
      } else {
        img.remove();
      }
    });
    
    // Also remove any broken image placeholders
    const placeholders = currentEditor.querySelectorAll('.broken-image-placeholder');
    placeholders.forEach(p => p.remove());
  }

  // Normalize spacing
  function normalizeSpacing() {
    // Remove excessive whitespace
    currentEditor.innerHTML = currentEditor.innerHTML
      .replace(/&nbsp;{2,}/g, ' ')
      .replace(/\s{2,}/g, ' ')
      .replace(/(<br\s*\/?>){3,}/gi, '<br><br>');

    // Ensure proper paragraph spacing
    const paragraphs = currentEditor.querySelectorAll('p');
    paragraphs.forEach(p => {
      if (p.innerHTML.trim() === '<br>' || p.innerHTML.trim() === '') {
        if (!p.nextElementSibling || p.nextElementSibling.tagName !== 'P') {
          p.innerHTML = '<br>';
        }
      }
    });
  }

  // Unwrap stuck content
  function unwrapStuckContent() {
    // Find nested contenteditable elements and unwrap them
    const editableElements = currentEditor.querySelectorAll('[contenteditable]');
    editableElements.forEach(el => {
      if (el !== currentEditor) {
        // Move content out of the wrapper
        while (el.firstChild) {
          el.parentNode.insertBefore(el.firstChild, el);
        }
        el.remove();
      }
    });

    // Unwrap unnecessary divs
    const divs = currentEditor.querySelectorAll('div');
    divs.forEach(div => {
      if (!div.className && !div.style.cssText && !div.querySelector('img')) {
        const p = document.createElement('p');
        p.innerHTML = div.innerHTML;
        div.parentNode.replaceChild(p, div);
      }
    });
  }

  // Clear formatting
  function clearFormatting() {
    const selection = window.getSelection();
    if (selection.rangeCount > 0) {
      document.execCommand('removeFormat', false, null);
      document.execCommand('unlink', false, null);
    }
  }

  // Reset selected content
  function resetSelectedContent() {
    const selection = window.getSelection();
    if (selection.rangeCount > 0 && !selection.isCollapsed) {
      if (confirm('This will delete the selected content. Are you sure?')) {
        document.execCommand('delete', false, null);
      }
    } else {
      alert('Please select the content you want to reset.');
    }
  }

  // Update editor content
  function updateEditorContent() {
    const contentInput = document.getElementById('content');
    if (contentInput && currentEditor) {
      contentInput.value = currentEditor.innerHTML;
    }
  }

  // Initialize link modal
  function initLinkModal() {
    const modal = document.getElementById('link-modal');
    const closeBtn = modal?.querySelector('.modal-close-btn');
    const cancelBtn = document.getElementById('cancel-link-btn');
    const insertBtn = document.getElementById('insert-link-btn');
    
    // Radio button handlers
    const radioButtons = modal?.querySelectorAll('input[name="link-type"]');
    radioButtons?.forEach(radio => {
      radio.addEventListener('change', (e) => {
        const externalFields = document.getElementById('external-link-fields');
        const internalFields = document.getElementById('internal-link-fields');
        
        if (e.target.value === 'external') {
          externalFields.style.display = 'block';
          internalFields.style.display = 'none';
        } else {
          externalFields.style.display = 'none';
          internalFields.style.display = 'block';
        }
      });
    });

    // Close modal handlers
    closeBtn?.addEventListener('click', () => closeLinkModal());
    cancelBtn?.addEventListener('click', () => closeLinkModal());

    // Insert link handler
    insertBtn?.addEventListener('click', () => {
      insertLink();
      closeLinkModal();
    });
  }

  // Open link modal
  window.openLinkModal = function() {
    const modal = document.getElementById('link-modal');
    const selection = window.getSelection();
    
    // Store current selection
    if (selection.rangeCount > 0) {
      selectedRange = selection.getRangeAt(0);
      
      // Pre-fill link text if text is selected
      if (!selection.isCollapsed) {
        const linkText = document.getElementById('link-text');
        linkText.value = selection.toString();
      }
    }
    
    modal.classList.add('active');
  };

  // Close link modal
  function closeLinkModal() {
    const modal = document.getElementById('link-modal');
    modal.classList.remove('active');
    
    // Clear form
    document.getElementById('link-url').value = '';
    document.getElementById('link-text').value = '';
    document.getElementById('link-new-tab').checked = false;
    document.querySelector('input[name="link-type"][value="external"]').checked = true;
    document.getElementById('external-link-fields').style.display = 'block';
    document.getElementById('internal-link-fields').style.display = 'none';
  }

  // Insert link
  function insertLink() {
    const linkType = document.querySelector('input[name="link-type"]:checked').value;
    let url = '';
    
    if (linkType === 'external') {
      url = document.getElementById('link-url').value;
    } else {
      url = document.getElementById('internal-page').value;
    }
    
    const linkText = document.getElementById('link-text').value || url;
    const newTab = document.getElementById('link-new-tab').checked;
    
    if (!url) {
      alert('Please enter a URL');
      return;
    }
    
    // Create link element
    const link = document.createElement('a');
    link.href = url;
    link.textContent = linkText;
    if (newTab) {
      link.target = '_blank';
      link.rel = 'noopener noreferrer';
    }
    
    // Insert link at stored selection
    if (selectedRange) {
      selectedRange.deleteContents();
      selectedRange.insertNode(link);
      
      // Move cursor after link
      const newRange = document.createRange();
      newRange.setStartAfter(link);
      newRange.collapse(true);
      
      const selection = window.getSelection();
      selection.removeAllRanges();
      selection.addRange(newRange);
    }
    
    updateEditorContent();
  }

  // Initialize overlay modal
  function initOverlayModal() {
    const modal = document.getElementById('overlay-modal');
    const closeBtn = modal?.querySelector('.modal-close-btn');
    const cancelBtn = document.getElementById('cancel-overlay-btn');
    const applyBtn = document.getElementById('apply-overlay-btn');
    
    // Position button handlers
    const positionBtns = modal?.querySelectorAll('.position-btn');
    positionBtns?.forEach(btn => {
      btn.addEventListener('click', () => {
        positionBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
      });
    });
    
    // Close modal handlers
    closeBtn?.addEventListener('click', () => closeOverlayModal());
    cancelBtn?.addEventListener('click', () => closeOverlayModal());
    
    // Apply overlay handler
    applyBtn?.addEventListener('click', () => {
      applyImageOverlay();
      closeOverlayModal();
    });
  }

  // Open overlay modal
  window.openOverlayModal = function(img) {
    window.currentOverlayImage = img;
    const modal = document.getElementById('overlay-modal');
    modal.classList.add('active');
  };

  // Close overlay modal
  function closeOverlayModal() {
    const modal = document.getElementById('overlay-modal');
    modal.classList.remove('active');
    document.getElementById('overlay-text').value = '';
    window.currentOverlayImage = null;
  }

  // Apply image overlay
  function applyImageOverlay() {
    const img = window.currentOverlayImage;
    if (!img) return;
    
    const overlayText = document.getElementById('overlay-text').value;
    const position = document.querySelector('.position-btn.active').dataset.position;
    const style = document.getElementById('overlay-style').value;
    
    if (!overlayText) {
      alert('Please enter overlay text');
      return;
    }
    
    // Create wrapper with overlay
    const wrapper = document.createElement('div');
    wrapper.className = 'image-with-overlay';
    wrapper.style.position = 'relative';
    wrapper.style.display = 'inline-block';
    
    // Clone image
    const newImg = img.cloneNode(true);
    wrapper.appendChild(newImg);
    
    // Create overlay
    const overlay = document.createElement('div');
    overlay.className = `image-overlay-text ${position} ${style}`;
    overlay.innerHTML = overlayText;
    overlay.style.position = 'absolute';
    
    // Position the overlay
    setOverlayPosition(overlay, position);
    setOverlayStyle(overlay, style);
    
    wrapper.appendChild(overlay);
    
    // Replace original image
    img.parentNode.replaceChild(wrapper, img);
    
    updateEditorContent();
  }

  // Set overlay position
  function setOverlayPosition(overlay, position) {
    const positions = {
      'top-left': { top: '10px', left: '10px' },
      'top-center': { top: '10px', left: '50%', transform: 'translateX(-50%)' },
      'top-right': { top: '10px', right: '10px' },
      'center-left': { top: '50%', left: '10px', transform: 'translateY(-50%)' },
      'center': { top: '50%', left: '50%', transform: 'translate(-50%, -50%)' },
      'center-right': { top: '50%', right: '10px', transform: 'translateY(-50%)' },
      'bottom-left': { bottom: '10px', left: '10px' },
      'bottom-center': { bottom: '10px', left: '50%', transform: 'translateX(-50%)' },
      'bottom-right': { bottom: '10px', right: '10px' }
    };
    
    const pos = positions[position] || positions['center'];
    Object.assign(overlay.style, pos);
  }

  // Set overlay style
  function setOverlayStyle(overlay, style) {
    const styles = {
      'light': {
        color: 'white',
        backgroundColor: 'rgba(0, 0, 0, 0.7)',
        padding: '0.5rem 1rem',
        borderRadius: '4px'
      },
      'dark': {
        color: 'black',
        backgroundColor: 'rgba(255, 255, 255, 0.9)',
        padding: '0.5rem 1rem',
        borderRadius: '4px'
      },
      'bold': {
        color: 'white',
        textShadow: '2px 2px 4px rgba(0, 0, 0, 0.8)',
        fontWeight: 'bold',
        fontSize: '1.25rem',
        padding: '0.5rem'
      }
    };
    
    const s = styles[style] || styles['light'];
    Object.assign(overlay.style, s);
  }

  // Export functions
  window.showCleanupPanel = function() {
    const panel = document.getElementById('cleanup-panel');
    panel.classList.add('active');
  };

  window.setCurrentEditor = function(editor) {
    currentEditor = editor;
  };

  // Initialize on load
  document.addEventListener('DOMContentLoaded', () => {
    initLinkModal();
    initOverlayModal();
    initCleanupPanel();
  });
</script>